package com.buhov.family.FamilyData;

import android.app.AlertDialog;
import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.os.AsyncTask;
import android.preference.PreferenceManager;

import com.buhov.family.FamilyApplication;
import com.buhov.family.MyPedigreesActivity;
import com.buhov.family.R;
import com.buhov.family.RegisterActivity;
import com.buhov.family.FamilyDb.FamilyDbHelper;
import com.buhov.family.FamilyHttpClient.FamilyHttpClient;
import com.buhov.family.FamilyHttpClient.FamilyServiceException;
import com.buhov.family.FamilyHttpClient.Entities.Pedigree;
import com.buhov.family.FamilyHttpClient.Entities.User;
import com.buhov.family.FamilyHttpClient.Entities.UserDTO;

public class FamilyData {
	
	private FamilyApplication app;
	private FamilyDbHelper db;
	private FamilyHttpClient httpClient;
	
	public FamilyData(Context context, FamilyDbHelper db, FamilyHttpClient httpClient) {
		this.app = (FamilyApplication)context.getApplicationContext();
		this.db = db;
		this.httpClient = httpClient;
	}
	
	public User Register(UserDTO user) {
		try {
			return this.httpClient.Register(user);
		}
		catch(FamilyServiceException e) {
			throw new FamilyDataException(e.getMessage());
		}
	}
	
	public Pedigree[] GetPedigrees(UserDTO user) {
		
			try {
				Pedigree[] pedigrees;
				if(this.app.isOnline()) {
					pedigrees = this.httpClient.GetPedigrees(user);
					this.db.Update(pedigrees);
				}
			} catch(FamilyServiceException e) {
				throw new FamilyDataException(e.getMessage());
			}
	}
}
