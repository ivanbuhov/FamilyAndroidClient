package com.buhov.FamilyHttpClient;

import java.io.*;

import org.apache.http.*;
import org.apache.http.client.*;
import org.apache.http.client.methods.*;
import org.apache.http.entity.*;
import org.apache.http.impl.client.*;

import com.buhov.FamilyHttpClient.Entities.*;
import com.google.gson.*;

public class FamilyHttpClient {
	
	private static final String HEADER_USERNAME = "X-Family-Username";
	private static final String HEADER_PASSWORD = "X-Family-Password";
	
	private static final String SERVICE_ROOT = "http://family.apphb.com/api/";
	private static final String SERVICE_REGISTER_URL = SERVICE_ROOT + "Users/Register";
	
	private HttpClient client;
	private Gson gson;
	
	public FamilyHttpClient() {
		this.client = new DefaultHttpClient();
		this.gson = new Gson();
	}

	public void Register(UserDTO user) throws UnsupportedEncodingException {
		
	}
	
	private <TBody> void PostRequest(String url, TBody entityToSend, UserDTO user) throws UnsupportedEncodingException {
		HttpPost request = new HttpPost(url);
		if(user != null) {
			this.addAuthenticationHeaders(request, user);
		}
		String entityJSON = this.gson.toJson(entityToSend);
		request.setEntity(new StringEntity(entityJSON));
		try {
			HttpResponse response = this.client.execute(request);
			BufferedReader reader = new BufferedReader(
					new InputStreamReader(response.getEntity().getContent()));
			StringBuilder result = new StringBuilder();
			String line;
			while ((line = reader.readLine()) != null) {
				result.append(line);
			}
			// .... TODO: Parse result and handle errors
		}
		catch(Exception e) {
			
		}
	}
	
	private void addAuthenticationHeaders(HttpRequest request, UserDTO user) {
		request.addHeader(HEADER_USERNAME, user.getUsername());
		request.addHeader(HEADER_PASSWORD, user.getPassword());
	}
}

