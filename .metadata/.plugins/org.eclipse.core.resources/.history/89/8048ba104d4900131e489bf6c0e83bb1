package com.buhov.family.FamilyDb;

import android.content.ContentValues;
import android.database.sqlite.SQLiteDatabase;

import com.buhov.family.FamilyHttpClient.Entities.Pedigree;
import com.buhov.family.FamilyHttpClient.Entities.User;

public class FamilyDb {
	
	private FamilyDbHelper helper;
	
	public FamilyDb(FamilyDbHelper helper) {
		this.helper = helper;
	}
	
	public void Update(int userId, Pedigree[] pedigrees) {
		// Open the database for writing
		SQLiteDatabase db = this.helper.getWritableDatabase();
		
		// Delete all pedigrees from the current user
		db.delete(FamilyDbHelper.TABLE_NAME_PEDIGREES, FamilyDbHelper.C_PEDIGREES_OWNERID + "=" + userId, null);
		// Loop over the pedigrees and save them to the database
		ContentValues values = new ContentValues();
		for (Pedigree pedigree : pedigrees) {
			// Insert into database
			values.clear();
			values.put(FamilyDbHelper.C_ID, pedigree.getId());
			values.put(FamilyDbHelper.C_PEDIGREES_TITLE, pedigree.getTitle());
			values.put(FamilyDbHelper.C_PEDIGREES_OWNERID, pedigree.getOwnerId());
			db.insertOrThrow(FamilyDbHelper.TABLE_NAME_PEDIGREES, null, values);
		}
		
		db.close();
	}

	public void AddUser(User user) {
		// Open the database for writing
		SQLiteDatabase db = this.helper.getWritableDatabase();
		ContentValues values = new ContentValues();
		values.put(FamilyDbHelper.C_ID, user.getId());
		values.put(FamilyDbHelper.C_USERS_USERNAME, user.getUsername());
		values.put(FamilyDbHelper.C_USERS_AUTHCODE, user.getAuthCode());
		db.insertOrThrow(FamilyDbHelper.TABLE_NAME_USERS, null, values);
		db.close();
	}

}
